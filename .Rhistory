clust_6_plot <-
ggplot()+
geom_sf(data = st_as_sf(hydr_lines), col = "grey", lwd = 0.3, alpha = 0.8)+
geom_sf(data = st_as_sf(hydr_polygons), fill = "grey", alpha = 0.8, col = "grey", lwd = 0.4)+
geom_sf(data = st_as_sf(region), col = "grey30", lwd = 0.4, alpha = 0)+
geom_point(data = settlements, aes(x = Lon, y = Lat, size = Population/1000,
col = factor(clust_6)), alpha = 0.6, show.legend = F)+
geom_text(data = cluster_6_notations,
aes(label = clust_6, x = x_mean, y = y_mean),
family = "Arial",
color = "black")+
annotate("text", x = 12900000, y = 6640000, label = "в", size = 5, family = "Arial")+
scale_colour_manual(values = brewer.pal(n = 6, name = "Dark2"))+
scale_size_continuous(name = "Население,\nтыс. чел.", breaks = c(0.1, 1, 5, 20, 50, 100, 500),
range = c(0.2, 10),
labels = c("<= 0.1", "1", "5", "20", "50", "100", ">= 500"))+
coord_sf(crs = pulkovo1942.GK12, datum = NA)+
theme_void(base_size = 12, base_family = "Arial")
clust_18_plot <- ggplot()+
geom_sf(data=st_as_sf(rayons), fill = "white", col = "grey")+
geom_sf(data = st_as_sf(region), col = "grey30", lwd = 0.4, alpha = 0)+
geom_point(data = settlements, aes(x = Lon, y = Lat, size = Population/1000,
col = factor(clust_18)), show.legend = F, alpha = 0.6)+
geom_text(data = cluster_18_notations,
aes(label = clust_18, x = x_mean, y = y_mean),
family = "Arial",
color = "black")+
annotate("text", x = 12900000, y = 6640000, label = "г", size = 5, family = "Arial")+
scale_colour_manual(values = c(brewer.pal(n = 8, name = "Dark2"), brewer.pal(10, "Paired")))+
scale_size_continuous(name = "Население,\nтыс. чел.", breaks = c(0.1, 1, 5, 20, 50, 100, 500),
labels = c("<= 0.1", "1", "5", "20", "50", "100", ">= 500"),
range = c(0.2, 10))+
coord_sf(crs = pulkovo1942.GK12, datum = NA)+
theme_void(base_size = 12, base_family = "Arial")
fig_4 <- ggplot()+
coord_equal(xlim = c(0, 25), ylim = c(0, 18))+
annotation_custom(ggplotGrob(dendrogram),
xmin = 0, xmax = 13, ymin = 9, ymax = 18)+
annotation_custom(ggplotGrob(clust_3_plot),
xmin = 13, xmax = 25, ymin = 9, ymax = 18)+
annotation_custom(ggplotGrob(clust_6_plot),
xmin = 0, xmax = 13, ymin = 0, ymax = 9)+
annotation_custom(ggplotGrob(clust_18_plot),
xmin = 13, xmax = 25, ymin = 0, ymax = 9)+
labs(x = NULL, y = NULL)+
theme_void()
# Сохраним рисунок
ggsave(plot = fig_4, filename = "Fig4.jpeg", path = "plots/Иллюстрации для статьи/",
dpi = 200, device = "jpeg", width = 25, height = 18, units = "cm")
fig_4 <- ggplot()+
coord_equal(xlim = c(0, 25), ylim = c(0, 18))+
annotation_custom(ggplotGrob(dendrogram),
xmin = 0, xmax = 13, ymin = 9, ymax = 18)+
annotation_custom(ggplotGrob(clust_3_plot),
xmin = 12, xmax = 24, ymin = 9, ymax = 18)+
annotation_custom(ggplotGrob(clust_6_plot),
xmin = 0, xmax = 13, ymin = 0, ymax = 9)+
annotation_custom(ggplotGrob(clust_18_plot),
xmin = 12, xmax = 24, ymin = 0, ymax = 9)+
labs(x = NULL, y = NULL)+
theme_void()
# Сохраним рисунок
ggsave(plot = fig_4, filename = "Fig4.jpeg", path = "plots/Иллюстрации для статьи/",
dpi = 200, device = "jpeg", width = 25, height = 18, units = "cm")
fig_4 <- ggplot()+
coord_equal(xlim = c(0, 24.2), ylim = c(0, 18))+
annotation_custom(ggplotGrob(dendrogram),
xmin = 0, xmax = 13, ymin = 9, ymax = 18)+
annotation_custom(ggplotGrob(clust_3_plot),
xmin = 12.2, xmax = 24.2, ymin = 9, ymax = 18)+
annotation_custom(ggplotGrob(clust_6_plot),
xmin = 0, xmax = 13, ymin = 0, ymax = 9)+
annotation_custom(ggplotGrob(clust_18_plot),
xmin = 12.2, xmax = 24.2, ymin = 0, ymax = 9)+
labs(x = NULL, y = NULL)+
theme_void()
# Сохраним рисунок
ggsave(plot = fig_4, filename = "Fig4.jpeg", path = "plots/Иллюстрации для статьи/",
dpi = 200, device = "jpeg", width = 24.2, height = 18, units = "cm")
# Строим дендрограмму
dendrogram <-
my_dendro %>%
ggplot()+
geom_segment(aes(x=x, y=y , xend = xend, yend = yend, col = as.factor(clust_18)), show.legend = F)+
geom_rect(data = keys_6, aes(xmin=`min(x)`, xmax=`max(x)`, ymin=0, ymax=11000000),
col = "grey30", alpha = 0, lty = "dashed")+
geom_text(data = keys_6,
aes(label = clust_6, x = `max(x)` - 50, y = 9000000),
family = "Arial",
color = "grey30", fontface = "bold")+
geom_text_repel(data = labels, aes(label = label, x = x, y= y), angle = 90, direction = "x")+
annotate("text", x = 1300, y = 100000000, label = "(a)", size = 5, family = "Arial")+
scale_y_continuous(name = element_blank(), trans = "sqrt")+  # трансформируем шкалу y
scale_x_continuous(name = element_blank(), labels = 1:18, breaks = keys_18$`mean(x)`)+
scale_colour_manual(values = c(brewer.pal(n = 8, name = "Dark2"), brewer.pal(10, "Paired")), na.value = "black")+
theme_minimal(base_family = "Arial", base_size = 12)+
theme(panel.grid = element_blank(),
axis.ticks.x = element_line(),
# axis.line.x = element_line(),
axis.ticks.y = element_blank(),
axis.text.y = element_blank(),
plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
clust_3_plot <-
ggplot()+
geom_sf(data = st_as_sf(region), col = "grey30", lwd = 0.4, alpha = 0)+
geom_sf(data = st_as_sf(roads_fixed), col = "grey", lwd = 0.5, show.legend = F)+
geom_point(data = settlements, aes(x = Lon, y = Lat,
size = Population/1000,
col = factor(clust_3)), alpha = 0.6, show.legend = F)+
scale_colour_manual(values = brewer.pal(n = 3, name = "Dark2"))+
geom_text_repel(data = cities_labels_ru, aes(label = label, x = lon, y= lat),family = "Arial",
color = "black", direction = "x")+
annotate("text", x = 12900000, y = 6640000, label = "(б)", size = 5, family = "Arial")+
scale_size_continuous(breaks = c(0.1, 1, 5, 20, 50, 100, 500),
range = c(0.2, 10),
labels = c("<= 0.1", "1", "5", "20", "50", "100", ">= 500"))+
coord_sf(crs = pulkovo1942.GK12, datum = NA)+
theme_void(base_size = 12, base_family = "Arial")
clust_6_plot <-
ggplot()+
geom_sf(data = st_as_sf(hydr_lines), col = "grey", lwd = 0.3, alpha = 0.8)+
geom_sf(data = st_as_sf(hydr_polygons), fill = "grey", alpha = 0.8, col = "grey", lwd = 0.4)+
geom_sf(data = st_as_sf(region), col = "grey30", lwd = 0.4, alpha = 0)+
geom_point(data = settlements, aes(x = Lon, y = Lat, size = Population/1000,
col = factor(clust_6)), alpha = 0.6, show.legend = F)+
geom_text(data = cluster_6_notations,
aes(label = clust_6, x = x_mean, y = y_mean),
family = "Arial",
color = "black")+
annotate("text", x = 12900000, y = 6640000, label = "(в)", size = 5, family = "Arial")+
scale_colour_manual(values = brewer.pal(n = 6, name = "Dark2"))+
scale_size_continuous(name = "Население,\nтыс. чел.", breaks = c(0.1, 1, 5, 20, 50, 100, 500),
range = c(0.2, 10),
labels = c("<= 0.1", "1", "5", "20", "50", "100", ">= 500"))+
coord_sf(crs = pulkovo1942.GK12, datum = NA)+
theme_void(base_size = 12, base_family = "Arial")
clust_18_plot <- ggplot()+
geom_sf(data=st_as_sf(rayons), fill = "white", col = "grey")+
geom_sf(data = st_as_sf(region), col = "grey30", lwd = 0.4, alpha = 0)+
geom_point(data = settlements, aes(x = Lon, y = Lat, size = Population/1000,
col = factor(clust_18)), show.legend = F, alpha = 0.6)+
geom_text(data = cluster_18_notations,
aes(label = clust_18, x = x_mean, y = y_mean),
family = "Arial",
color = "black")+
annotate("text", x = 12900000, y = 6640000, label = "(г)", size = 5, family = "Arial")+
scale_colour_manual(values = c(brewer.pal(n = 8, name = "Dark2"), brewer.pal(10, "Paired")))+
scale_size_continuous(name = "Население,\nтыс. чел.", breaks = c(0.1, 1, 5, 20, 50, 100, 500),
labels = c("<= 0.1", "1", "5", "20", "50", "100", ">= 500"),
range = c(0.2, 10))+
coord_sf(crs = pulkovo1942.GK12, datum = NA)+
theme_void(base_size = 12, base_family = "Arial")
# =================
# Совместим рисунки
par(mar=c(0,0,0,0))
fig_4 <- ggplot()+
coord_equal(xlim = c(0, 24.2), ylim = c(0, 18))+
annotation_custom(ggplotGrob(dendrogram),
xmin = 0, xmax = 13, ymin = 9, ymax = 18)+
annotation_custom(ggplotGrob(clust_3_plot),
xmin = 12.2, xmax = 24.2, ymin = 9, ymax = 18)+
annotation_custom(ggplotGrob(clust_6_plot),
xmin = 0, xmax = 13, ymin = 0, ymax = 9)+
annotation_custom(ggplotGrob(clust_18_plot),
xmin = 12.2, xmax = 24.2, ymin = 0, ymax = 9)+
labs(x = NULL, y = NULL)+
theme_void()
# Сохраним рисунок
ggsave(plot = fig_4, filename = "Fig4.jpeg", path = "plots/Иллюстрации для статьи/",
dpi = 200, device = "jpeg", width = 24.2, height = 18, units = "cm")
# Сохраним рисунок
ggsave(plot = fig_4, filename = "Fig4.jpeg", path = "plots/Иллюстрации для статьи/",
dpi = 200, device = "jpeg", width = 23, height = 18, units = "cm")
# Сохраним рисунок
ggsave(plot = fig_4, filename = "Fig4.jpeg", path = "plots/Иллюстрации для статьи/",
dpi = 200, device = "jpeg", width = 24.2, height = 18, units = "cm")
fig_4 <- ggplot()+
coord_equal(xlim = c(0, 24.2), ylim = c(0, 18), expand = c(0, 0))+
annotation_custom(ggplotGrob(dendrogram),
xmin = 0, xmax = 13, ymin = 9, ymax = 18)+
annotation_custom(ggplotGrob(clust_3_plot),
xmin = 12.2, xmax = 24.2, ymin = 9, ymax = 18)+
annotation_custom(ggplotGrob(clust_6_plot),
xmin = 0, xmax = 13, ymin = 0, ymax = 9)+
annotation_custom(ggplotGrob(clust_18_plot),
xmin = 12.2, xmax = 24.2, ymin = 0, ymax = 9)+
labs(x = NULL, y = NULL)+
theme_void()
# Сохраним рисунок
ggsave(plot = fig_4, filename = "Fig4.jpeg", path = "plots/Иллюстрации для статьи/",
dpi = 200, device = "jpeg", width = 24.2, height = 18, units = "cm")
cowplot::ggsave(plot = fig_4, filename = "Fig4.eps", path = "plots/Иллюстрации для статьи/",
width = 24.2, height = 18, units = "cm", device = cairo_ps)
clust_3_plot <-
ggplot()+
geom_sf(data = st_as_sf(region), col = "grey30", lwd = 0.4, alpha = 0)+
geom_sf(data = st_as_sf(roads_fixed), col = "grey40", lwd = 0.5, show.legend = F)+
geom_point(data = settlements, aes(x = Lon, y = Lat,
size = Population/1000,
col = factor(clust_3)), alpha = 0.6, show.legend = F)+
scale_colour_manual(values = brewer.pal(n = 3, name = "Dark2"))+
geom_text_repel(data = cities_labels_ru, aes(label = label, x = lon, y= lat),family = "Arial",
color = "black", direction = "x")+
annotate("text", x = 12900000, y = 6640000, label = "(б)", size = 5, family = "Arial")+
scale_size_continuous(breaks = c(0.1, 1, 5, 20, 50, 100, 500),
range = c(0.2, 10),
labels = c("<= 0.1", "1", "5", "20", "50", "100", ">= 500"))+
coord_sf(crs = pulkovo1942.GK12, datum = NA)+
theme_void(base_size = 12, base_family = "Arial")
clust_3_plot
clust_3_plot <-
ggplot()+
geom_sf(data = st_as_sf(region), col = "grey30", lwd = 0.4, alpha = 0)+
geom_sf(data = st_as_sf(roads_fixed), col = "grey40", lwd = 0.5, show.legend = F)+
geom_point(data = settlements, aes(x = Lon, y = Lat,
size = Population/1000,
col = factor(clust_3)), alpha = 0.6, show.legend = F)+
scale_colour_manual(values = brewer.pal(n = 3, name = "Dark2"))+
geom_text_repel(data = cities_labels_ru, aes(label = label, x = lon, y= lat),family = "Arial",
color = "black", direction = "x")+
annotate("text", x = 12900000, y = 6640000, label = "(б)", size = 5, family = "Arial")+
scale_size_continuous(breaks = c(0.1, 1, 5, 20, 50, 100, 500),
range = c(0.2, 10),
labels = c("<= 0.1", "1", "5", "20", "50", "100", ">= 500"))+
coord_sf(crs = pulkovo1942.GK12, datum = NA)+
theme_void(base_size = 12, base_family = "Arial")
clust_6_plot <-
ggplot()+
geom_sf(data = st_as_sf(hydr_lines), col = "grey40", lwd = 0.3, alpha = 0.8)+
geom_sf(data = st_as_sf(hydr_polygons), fill = "grey40", alpha = 0.8, col = "grey", lwd = 0.4)+
geom_sf(data = st_as_sf(region), col = "grey30", lwd = 0.4, alpha = 0)+
geom_point(data = settlements, aes(x = Lon, y = Lat, size = Population/1000,
col = factor(clust_6)), alpha = 0.6, show.legend = F)+
geom_text(data = cluster_6_notations,
aes(label = clust_6, x = x_mean, y = y_mean),
family = "Arial",
color = "black")+
annotate("text", x = 12900000, y = 6640000, label = "(в)", size = 5, family = "Arial")+
scale_colour_manual(values = brewer.pal(n = 6, name = "Dark2"))+
scale_size_continuous(name = "Население,\nтыс. чел.", breaks = c(0.1, 1, 5, 20, 50, 100, 500),
range = c(0.2, 10),
labels = c("<= 0.1", "1", "5", "20", "50", "100", ">= 500"))+
coord_sf(crs = pulkovo1942.GK12, datum = NA)+
theme_void(base_size = 12, base_family = "Arial")
clust_18_plot <- ggplot()+
geom_sf(data=st_as_sf(rayons), fill = "white", col = "grey40")+
geom_sf(data = st_as_sf(region), col = "grey30", lwd = 0.4, alpha = 0)+
geom_point(data = settlements, aes(x = Lon, y = Lat, size = Population/1000,
col = factor(clust_18)), show.legend = F, alpha = 0.6)+
geom_text(data = cluster_18_notations,
aes(label = clust_18, x = x_mean, y = y_mean),
family = "Arial",
color = "black")+
annotate("text", x = 12900000, y = 6640000, label = "(г)", size = 5, family = "Arial")+
scale_colour_manual(values = c(brewer.pal(n = 8, name = "Dark2"), brewer.pal(10, "Paired")))+
scale_size_continuous(name = "Население,\nтыс. чел.", breaks = c(0.1, 1, 5, 20, 50, 100, 500),
labels = c("<= 0.1", "1", "5", "20", "50", "100", ">= 500"),
range = c(0.2, 10))+
coord_sf(crs = pulkovo1942.GK12, datum = NA)+
theme_void(base_size = 12, base_family = "Arial")
# =================
# Совместим рисунки
par(mar=c(0,0,0,0))
fig_4 <- ggplot()+
coord_equal(xlim = c(0, 24.2), ylim = c(0, 18), expand = c(0, 0))+
annotation_custom(ggplotGrob(dendrogram),
xmin = 0, xmax = 13, ymin = 9, ymax = 18)+
annotation_custom(ggplotGrob(clust_3_plot),
xmin = 12.2, xmax = 24.2, ymin = 9, ymax = 18)+
annotation_custom(ggplotGrob(clust_6_plot),
xmin = 0, xmax = 13, ymin = 0, ymax = 9)+
annotation_custom(ggplotGrob(clust_18_plot),
xmin = 12.2, xmax = 24.2, ymin = 0, ymax = 9)+
labs(x = NULL, y = NULL)+
theme_void()
# Сохраним рисунок
ggsave(plot = fig_4, filename = "Fig4.jpeg", path = "plots/Иллюстрации для статьи/",
dpi = 200, device = "jpeg", width = 24.2, height = 18, units = "cm")
cowplot::ggsave(plot = fig_4, filename = "Fig4.eps", path = "plots/Иллюстрации для статьи/",
width = 24.2, height = 18, units = "cm", device = cairo_ps)
library(sf)
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggforce)
library(grid)
load(file = "data/Part3_res_dataset.Rdata")
load("data/settlements.Rdata")
load("data/crs.Rdata")
y_ticks <- 80:105
y_ticks[-seq(1, 26, 5)] <- ""
x_ticks <- seq(0, 420, 20)
x_ticks[-seq(1, 22, 5)] <- ""
p1 <-
clusters_18_metrics %>%
ggplot(aes(y = CL18_pop2010to2002_rel, x = CL18_dist2Tyumen/1000))+
geom_point(aes(size = CL18_pop2002/1000), pch = 1, stroke = 1)+
geom_smooth(method = "glm", color = "red", se = F)+
annotate("text", label = "(a)", x = 420, y = 107.2, vjust = 0, size = 5, family = "Times New Roman")+
geom_label(aes(x = 270, y = 103, label = "Нас. пункты\nУватского района"),
hjust = 0,
vjust = 0.5,
lineheight = 0.8,
label.size = NA, size = 3)+
geom_segment(aes(x = 370, y = 101.5, xend = 405, yend = 100.55),
size=0.1)+
scale_x_continuous(name = "Расстояние до регионального центра, км",
breaks = seq(0, 420, 20), labels = x_ticks)+
scale_y_continuous(name = "Динамика числ. нас-я (2010 к 2002),%",
breaks =  80:105, labels = y_ticks)+
scale_size_continuous(name = "Численность\nнаселения\n(2002), тыс. чел.",
breaks = c(20, 50, 100, 200, 500), range = c(0.5, 10))+
coord_cartesian(ylim = c(80, 105), clip = 'off')+
theme_bw(base_size = 11, base_family = "Arial")+
theme(panel.grid = element_blank(),
axis.ticks = element_line(),
legend.position = "bottom",
plot.margin=unit(c(1,0.1,0.1,0.1),"cm"))+
guides(size=guide_legend(
keywidth=0.1,
keyheight=0.1,
default.unit="cm")
)
p2 <-
ggplot()+
geom_sf(data = st_as_sf(region), fill = "white")+
geom_point(data = df, aes(x = lon, y = lat, col = CL18_variance_dif), size = 0.8)+
annotate("text", label = "(б)", x = 12850736, y = 6680000, vjust = 0, size = 5, family = "Times New Roman")+
scale_color_viridis_c(name = "Динамика вариации людности\nнас-ных пунктов (2010 к 2002),%")+
coord_sf(crs = pulkovo1942.GK12, datum = NA, ylim = c(6135000, 6640000), clip = 'off')+
theme_bw(base_family = "Arial", base_size = 11)+
theme(axis.title = element_blank(),
axis.text = element_blank(),
panel.grid = element_blank(),
plot.margin=unit(c(1,0.1,0.1,0.1),"cm"),
legend.position = "bottom", legend.box.margin = unit(c(0,0,0,0),"cm"))
fig_5 <- gridExtra::grid.arrange(p1,p2, nrow = 1)
ggsave(plot = fig_5, filename = "Fig5.jpeg", path = "plots/Иллюстрации для статьи/",
dpi = 200, device = "jpeg", width = 21, height = 10.5, units = "cm")
cowplot::ggsave(plot = fig_6, filename = "Fig5.eps", path = "plots/Иллюстрации для статьи/",
width = 21, height = 10.5, units = "cm", device = cairo_ps)
cowplot::ggsave(plot = fig_5, filename = "Fig5.eps", path = "plots/Иллюстрации для статьи/",
width = 21, height = 10.5, units = "cm", device = cairo_ps)
x_ticks <- 80:105
x_ticks[-seq(1, 26, 5)] <- ""
y_ticks <- 100:117
y_ticks[-seq(1,17,5)] <- ""
fig_6 <- clusters_18_metrics %>%
ggplot(aes(x = CL18_pop2010to2002_rel, y = CL18_variance_dif))+
geom_point(aes(size = CL18_pop2002/1000), pch = 1, stroke = 1)+
# geom_point(aes())+
geom_circle(data = data_frame(x = c(90, 98), y = c(112, 104)),
mapping = aes(x0 = x, y0 = y, r = 5.6),
color = "grey70",linetype = "dotted",  alpha = 1,
inherit.aes = F)+
annotate("text", x = 99, y = 108.5, label = "a", size = 5, family = "Times New Roman")+
annotate("text", x = 91, y = 116, label = "б", size = 5,family = "Times New Roman")+
scale_x_continuous(name = "Динамика численности населения, %",
breaks =  80:105, labels = x_ticks)+
scale_y_continuous(name = "Динамики вариации людности\nнаселенных пунктов, %",
breaks =  100:117, labels = y_ticks)+
scale_size_continuous(name = "Численность\nнаселения\n(2002), тыс. чел.",
breaks = c(20, 50, 100, 200, 500), range = c(0.5, 10))+
coord_equal()+
theme_bw(base_size = 12, base_family = "Times New Roman")+
theme(panel.grid = element_blank(),
axis.ticks = element_line(),
plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
# Экспорт
ggsave(plot = fig_6, filename = "Fig6.jpeg", path = "plots/Иллюстрации для статьи/",
dpi = 200, device = "jpeg", width = 18, height = 10, units = "cm")
cowplot::ggsave(plot = fig_6, filename = "Fig6.eps", path = "plots/Иллюстрации для статьи/",
width = 18, height = 11, units = "cm", device = cairo_ps)
library(dplyr)
library(tidyr)
library(corrplot)
library(lme4)
library(stargazer)
library(ggplot2)
library(gridExtra)
library(RColorBrewer)
# Загрузка данных
load(file = "data/Part3_res_dataset.Rdata")
# Define helper fucntion to extract legend from ggplot object
# Source: https://stackoverflow.com/questions/12041042/how-to-plot-just-the-legends-in-ggplot2
g_legend<-function(a.gplot){
tmp <- ggplot_gtable(ggplot_build(a.gplot))
leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
legend <- tmp$grobs[[leg]]
legend
}
# Удалим населенные пункты, которые исчезли в результате поглощения городами
df %>%
filter(!(pop2010to2002_rel == 0 & Census2002 > 1000 & MunicipalDistrict == "Тобольский район")) %>%
filter(!(pop2010to2002_rel == 0 & MunicipalDistrict == "Тюменский район")) %>%
# Выделим из набора данных интересующие нас предикторы
dplyr::select(clust_6, clust_18, Census2002, pop2010to2002_rel, starts_with("clo"), starts_with("betw"), -ends_with("w"), - clo) ->
df_cleaned
# Удалим выбросы за пределами 3 медианных абсолютных отклонений
df_cleaned %>%
mutate(dev = pop2010to2002_rel - median(pop2010to2002_rel)) %>%
filter(dev <= 3*mad(pop2010to2002_rel)) %>%
dplyr::select(-dev) -> df_cleaned
# Создадим новую переменную: логарифм численности (2002),
# которая послужит в модели в качестве контрольной
df_cleaned %>%
mutate(logPop = log(Census2002)) ->
df_cleaned
# Приведем метрики центральности к стандартизированному виду
df_cleaned %>%
mutate_at(.vars = vars(clo_CL6, clo_CL18, betw_CL6, betw_CL18), scale) -> df_cleaned
# Проверка предикторов на корреляцию
corr <- cor(df_cleaned %>% select(pop2010to2002_rel, logPop, clo_CL6, clo_CL18, betw_CL6, betw_CL18))
# Проверка предикторов на корреляцию
corr <- cor(df_cleaned %>% dplyr::select(pop2010to2002_rel, logPop, clo_CL6, clo_CL18, betw_CL6, betw_CL18))
# colnames(corr) <- c("Динамика числ. нас-я\n(2010 к 2002),%","log(числ. нас-я, 2002)", "ЦБ(6)", "ЦБ(18)", "ЦП(98)", "ЦП(52)")
# rownames(corr) <- c("Динамика числ. нас-я\n(2010 к 2002),%","log(числ. нас-я, 2002)", "Ц0Б(6)", "ЦБ(18)", "ЦП(98)", "ЦП(52)")
corrplot(corr, method = "number", type = "full", insig = "p-value", col = viridis::inferno(12))
model1 <- lmer(pop2010to2002_rel ~ logPop + clo_CL6 + clo_CL18 + betw_CL18 + (1|clust_6/clust_18) + (0 + clo_CL6|clust_6) + (0 + clo_CL18|clust_18), REML = F, data = df_cleaned)
model2 <- lmer(pop2010to2002_rel ~ logPop + clo_CL6 + clo_CL18 + betw_CL6 + (1|clust_6/clust_18) + (0 + clo_CL6|clust_6) + (0 + clo_CL18|clust_18), REML = F, data = df_cleaned)
# Центральность по близости (6) vs Динамика населения
clo_CL6_vs_popDyn <- df_cleaned %>%
ggplot(aes(y = pop2010to2002_rel, x = clo_CL6, fill = as.factor(clust_6), col = as.factor(clust_6)))+
geom_point(shape = 21, stroke = 0, alpha = 0.4, size = 1.2)+
geom_smooth(method = "glm", se = F)+
geom_hline(aes(yintercept = 100), linetype = "dashed", col = "grey3")+
scale_y_continuous(name = "Динамика числ-и населения (2010 к 2002), %",
limits = c(0, 150),
breaks = seq(0, 140, 10), labels = pop.labels)+
scale_x_continuous(name = "Центральность по близости (6 кластеров)",
breaks = seq(-2, 4, 1))+
scale_fill_manual(name = "Кластер", values = brewer.pal(n = 6, name = "Dark2"))+
scale_colour_manual(name = "Кластер", values = brewer.pal(n = 6, name = "Dark2"))+
theme_bw(base_size = 12, base_family = "Arial")+
theme(panel.grid = element_blank(),
axis.ticks = element_line(),
# legend.position = "bottom",
# legend.direction = "horizontal",
legend.title = element_text(size = 12),
legend.box = "horizontal",
plot.margin=unit(c(0.1,0.1,0.3,0.1),"cm"))+
guides(fill = FALSE)
pop.labels <- seq(0, 140, 10)
pop.labels
y_ticks[-seq(1, 15, 2)]
pop.labels[-seq(1, 15, 2)]
pop.labels[-seq(2, 15, 2)]
pop.labels[-seq(1, 15, 2)] <- ""
# Центральность по близости (6) vs Динамика населения
clo_CL6_vs_popDyn <- df_cleaned %>%
ggplot(aes(y = pop2010to2002_rel, x = clo_CL6, fill = as.factor(clust_6), col = as.factor(clust_6)))+
geom_point(shape = 21, stroke = 0, alpha = 0.4, size = 1.2)+
geom_smooth(method = "glm", se = F)+
geom_hline(aes(yintercept = 100), linetype = "dashed", col = "grey3")+
scale_y_continuous(name = "Динамика числ-и населения (2010 к 2002), %",
limits = c(0, 150),
breaks = seq(0, 140, 10), labels = pop.labels)+
scale_x_continuous(name = "Центральность по близости (6 кластеров)",
breaks = seq(-2, 4, 1))+
scale_fill_manual(name = "Кластер", values = brewer.pal(n = 6, name = "Dark2"))+
scale_colour_manual(name = "Кластер", values = brewer.pal(n = 6, name = "Dark2"))+
theme_bw(base_size = 12, base_family = "Arial")+
theme(panel.grid = element_blank(),
axis.ticks = element_line(),
# legend.position = "bottom",
# legend.direction = "horizontal",
legend.title = element_text(size = 12),
legend.box = "horizontal",
plot.margin=unit(c(0.1,0.1,0.3,0.1),"cm"))+
guides(fill = FALSE)
# Центральность по посредничеству (6) vs Динамика населения
betw_CL6_vs_popDyn <- df_cleaned %>%
ggplot(aes(y = pop2010to2002_rel, x = betw_CL6, col = as.factor(clust_6)))+
geom_point(alpha = 0.4, stroke = 0, size = 1.2)+
geom_smooth(method = "glm", se = F)+
geom_hline(aes(yintercept = 100), linetype = "dashed", col = "grey3")+
scale_y_continuous(name = "Динамика числ-и населения (2010 к 2002), %",
limits = c(0, 150),
breaks = seq(0, 140, 10), labels = pop.labels)+
scale_x_continuous(name = "Центральность по посредничеству",
breaks = seq(-2, 6, 1))+
scale_fill_manual(name = "Кластер", values = brewer.pal(n = 6, name = "Dark2"))+
scale_colour_manual(name = "Кластер", values = brewer.pal(n = 6, name = "Dark2"))+
theme_bw(base_size = 12, base_family = "Arial")+
theme(panel.grid = element_blank(),
axis.ticks = element_line(),
legend.position = "bottom",
# legend.direction = "horizontal",
legend.title = element_text(size = 12),
plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))+
guides(colour = guide_legend(title.position = "top", nrow = 1))
# Извлечем легенду
color_legend <- g_legend(betw_CL6_vs_popDyn)
# Совместим графики
par(mar=c(0,0,0,0))
fig_7 <- ggplot()+
coord_equal(xlim = c(0, 10), ylim = c(0, 13), expand = c(0.1,0.1))+
annotation_custom(ggplotGrob(clo_CL6_vs_popDyn +
guides(colour = FALSE)),
xmin = 0, xmax = 10, ymin = 7, ymax = 13)+
annotation_custom(ggplotGrob(betw_CL6_vs_popDyn + guides(colour = FALSE)),
xmin = 0, xmax = 10, ymin = 1, ymax = 7)+
annotation_custom(color_legend,
xmin = 2, xmax = 5, ymin = 0, ymax = 1)+
labs(x = NULL, y = NULL)+
theme_void()+
theme(plot.margin=unit(c(0.1,0.1,0.1,0.1),"cm"))
# Сохраним графики
ggsave(plot = fig_7, filename = "Fig7.jpeg", path = "plots/Иллюстрации для статьи/",
dpi = 200, device = "jpeg", width = 18, height = 22, units = "cm")
cowplot::ggsave(plot = fig_7, filename = "Fig7.eps", path = "plots/Иллюстрации для статьи/",
width = 18, height = 22, units = "cm", device = cairo_ps)
