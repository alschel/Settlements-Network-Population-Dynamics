temp_matrix_w <- temp_matrix * temp_pop_matrix
# Calculate edge_density
df[df$clust_6 == i,]$clo_CL6_w <- 1/(temp_matrix_w %>% apply(1, sum, na.rm = T))
}
df$clo_CL18 <- NA_real_
# Calculate
for (i in 1:nrow(clusters_18_metrics)) {
# Define logical vector to subset settlements by the cluster
select_condition <- clust_18_2002 == i
# Subset distance matrix
temp_matrix <- dist_matrix_2002[select_condition, select_condition]
# Calculate edge_density
df[df$clust_18 == i,]$clo_CL18 <- 1/(temp_matrix %>% apply(1, sum))
}
df$clo_CL18_w <- NA_real_
# Calculate
for (i in 1:nrow(clusters_18_metrics)) {
# Define logical vector to subset settlements by the cluster
select_condition <- clust_18_2002 == i
# Subset distance matrix
temp_matrix <- dist_matrix_2002[select_condition, select_condition]
# Create matrix of population sizes in 2002
temp_pop_matrix <- rep.row(normalize(settlements_2002[select_condition,]$Census2002),
nrow(temp_matrix))
# Calculate distance matrices, weighted by population (_w)
temp_matrix_w <- temp_matrix * temp_pop_matrix
# Calculate edge_density
df[df$clust_18 == i,]$clo_CL18_w <- 1/(temp_matrix_w %>% apply(1, sum, na.rm = T))
}
# 6 clusters
clusters_6_metrics$CL6_median_path <- NA_real_
# Calculate
for (i in 1:nrow(clusters_6_metrics)) {
# Define logical vector to subset settlements by the cluster
select_condition <- clust_6_2002 == i
# Subset distance matrix
temp_matrix <- dist_matrix_2002[select_condition, select_condition]
# Calculate edge_density
clusters_6_metrics[clusters_6_metrics$clust_6 == i,]$CL6_median_path <- median(temp_matrix)
}
# 18 clusters
clusters_18_metrics$CL18_median_path <- NA_real_
# Calculate
for (i in 1:nrow(clusters_18_metrics)) {
# Define logical vector to subset settlements by the cluster
select_condition <- clust_18_2002 == i
# Subset distance matrix
temp_matrix <- dist_matrix_2002[select_condition, select_condition]
# Calculate edge_density
clusters_18_metrics[clusters_18_metrics$clust_18 == i,]$CL18_median_path <- median(temp_matrix)
}
df$betw_CL6 <- estimate_betweenness(graph = res_graph_2002,
vids = settl_index_2002,
cutoff = median(clusters_6_metrics$CL6_median_path))
df$betw_CL18 <- estimate_betweenness(graph = res_graph_2002,
vids = settl_index_2002,
cutoff = median(clusters_18_metrics$CL18_median_path))
# Distribution of values
df %>%
ggplot(aes(x = betw_CL18))+
geom_density()
df %>%
ggplot(aes(x = betw_CL6))+
geom_density()
# Distributions are similiar. Let's compare the values?
df %>%
ggplot(aes(x = betw_CL18, y = betw_CL6))+
geom_point()
cor(df$betw_CL18, df$betw_CL6) # 0.86 - the values are highly correlated.
# Betweenness Centrality vs Population Dynamics
df %>%
filter(pop2010to2002_rel < 200) %>%
ggplot(aes(x = betw_CL6, y = pop2010to2002_rel))+
geom_point(aes(col = betw_CL6), alpha = 0.4)+
geom_smooth(method = "glm")+
scale_colour_gradientn(colours = viridis(7), trans = "sqrt")
# Combine all the metrics into a single dataset
df %>%
left_join(clusters_6_metrics, by = "clust_6") %>%
left_join(clusters_18_metrics %>% select(-clust_6), by = "clust_18") -> df
# Combine all the metrics into a single dataset
df %>%
left_join(clusters_6_metrics, by = "clust_6") %>%
left_join(clusters_18_metrics %>% dplyr::select(-clust_6), by = "clust_18") -> df
View(df)
# Save datasets into Rdatafile
save(df, clusters_6_metrics, clusters_18_metrics, file = "data/Part3_res_dataset.Rdata")
install.packages("corrplot")
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggforce)
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggforce)
library(corrplot)
library(caret)
load(file = "data/Part3_res_dataset.Rdata")
load("data/settlements.Rdata")
View(df)
df %>%
dplyr:: select(-id, - lon, -lat, -ShortName, -MunicipalDistrict, -Rosstat1990, -clust_3, -clust_6, -clust_18)->
df_cleaned
summary(df_cleaned)
?corrplot
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggforce)
library(corrplot)
library(caret)
library(RColorBrewer)
?brewer.pal
corr <- cor(df_cleaned)
corrplot(corr, method = "color", type = "upper", col = brewer.pal(5, "RdYlBu"))
corr <- cor(df_cleaned)
corrplot(corr, method = "color", type = "upper")
corr <- cor(df_cleaned)
corrplot(corr, method = "circle", type = "upper")
findCorrelation(corr, cutoff = 0.8)
?findCorrelation
findCorrelation(corr, cutoff = 0.)
findCorrelation(corr, cutoff = 0.8, names = T)
?createModel
?rfStats
df_cleaned %>% dplyr::select(-findCorrelation(corr, cutoff = 0.8, names = T)) -> df_cleaned
findCorrelation(corr, cutoff = 0.8, names = T)
df_cleaned %>% dplyr::select(-findCorrelation(corr, cutoff = 0.8, names = T))
df_cleaned %>% dplyr::select(-c(findCorrelation(corr, cutoff = 0.8, names = T))) -> df_cleaned
rfe(df_cleaned[,-3],df_cleaned$pop2010to2002_rel)
rfe(x = df_cleaned[,-3], y = df_cleaned$pop2010to2002_rel)
df_cleaned %>%
dplyr::select(-Census2010,            # оставим Census2002
distance2Tyumen, clo_w # важные переменные, которые сильно коррелируют. Я бы затестил каждую, чтобы понять, которая вносит более весомый вклад
)
load(file = "data/Part3_res_dataset.Rdata")
load("data/settlements.Rdata")
df %>%
dplyr:: select(-id, - lon, -lat, -ShortName, -MunicipalDistrict, -Rosstat1990, -clust_3, -clust_6, -clust_18)->
df_cleaned
df_cleaned %>%
dplyr::select(-Census2010,            # оставим Census2002
distance2Tyumen, clo_w # важные переменные, которые сильно коррелируют. Я бы затестил каждую, чтобы понять, которая вносит более весомый вклад
)
df_cleaned %>%
dplyr::select(-Census2010,            # оставим Census2002
dist2Tyumen, clo_w # важные переменные, которые сильно коррелируют. Я бы затестил каждую, чтобы понять, которая вносит более весомый вклад
)
df_cleaned %>%
dplyr::select(-Census2010,            # оставим Census2002
-dist2Tyumen, -clo_w # важные переменные, которые сильно коррелируют. Я бы затестил каждую, чтобы понять, которая вносит более весомый вклад
)
findCorrelation(corr, cutoff = 0.8, names = T)
corr <- cor(df_cleaned)
corrplot(corr, method = "circle")
findCorrelation(corr, cutoff = 0.8, names = T)
View(clusters_6_metrics)
median(clusters_6_metrics$CL6_median_path)
median(clusters_18_metrics$CL18_median_path)
df_cleaned %>%
gpplot(aes(x = betw_CL6, betw_CL18))+
geom_point()
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggforce)
library(corrplot)
library(caret)
library(RColorBrewer)
df_cleaned %>%
gpplot(aes(x = betw_CL6, betw_CL18))+
geom_point()
df_cleaned %>%
ggplot(aes(x = betw_CL6, betw_CL18))+
geom_point()
df_cleaned %>%
ggplot(aes(x = clo_CL18, betw_CL18))+
geom_point()
df_cleaned %>%
ggplot(aes(betw_CL18, pop2010to2002_rel))+
geom_point()
df_cleaned %>%
ggplot(aes(betw_CL6, pop2010to2002_rel))+
geom_point()
df_cleaned %>%
ggplot(aes(CL6_n, clo_CL6))+
geom_point()
df_cleaned %>%
dplyr::select(-Census2010,
-CL18_dist2Tyumen,
-betw_CL18,
-CL6_n,
-CL6_pop2010,
-CL18_pop2010,
-CL6_variance_2010,
-CL18_variance_2010,
-CL6_pop2010to2002_rel,
-CL6_max_pop2002,
-CL6_mean_pop2002,
CL6_median_pop2002) %>% cor() -> corr
corrplot(corr, method = "circle")
df_cleaned %>%
dplyr::select(-Census2010,
-CL18_dist2Tyumen,
-betw_CL18,
-CL6_n,
-CL6_pop2010,
-CL18_pop2010,
-CL6_variance_2010,
-CL18_variance_2010,
-CL6_pop2010to2002_rel,
-CL6_max_pop2002,
-CL6_mean_pop2002,
-CL6_median_pop2002,
-CL18_max_pop2002,
-CL18_mean_pop2002,
-CL18_median_pop2002,) %>% cor() -> corr
corrplot(corr, method = "circle")
df_cleaned %>%
dplyr::select(-Census2010,
-CL18_dist2Tyumen,
-betw_CL18,
-CL6_n,
-CL6_pop2010,
-CL18_pop2010,
-CL6_variance_2010,
-CL18_variance_2010,
-CL6_pop2010to2002_rel,
-CL6_max_pop2002,
-CL6_mean_pop2002,
-CL6_median_pop2002,
-CL18_max_pop2002,
-CL18_mean_pop2002,
-CL18_median_pop2002) %>% cor() -> corr
corrplot(corr, method = "circle")
df_cleaned %>%
ggplot(aes(x = CL18_centr_clo, y = clo_CL18))
df_cleaned %>%
ggplot(aes(x = CL18_centr_clo, y = clo_CL18))+
geom_point()
df_cleaned %>%
dplyr::select(-Census2010,
-CL18_dist2Tyumen,
-betw_CL18,
-CL6_n,
-CL6_pop2002,
-CL6_pop2010,
-CL18_pop2002,
-CL18_pop2010,
-CL6_variance_2010,
-CL18_variance_2010,
-CL6_pop2010to2002_rel,
-CL6_max_pop2002,
-CL6_mean_pop2002,
-CL6_median_pop2002,
-CL18_max_pop2002,
-CL18_mean_pop2002,
-CL18_median_pop2002) %>% cor() -> corr
corrplot(corr, method = "circle")
df_cleaned %>%
dplyr::select(-Census2010,
-CL18_dist2Tyumen,
-betw_CL18,
-CL6_n,
-CL6_pop2002,
-CL6_pop2010,
-CL18_pop2002,
-CL18_pop2010,
-CL6_variance_2010,
-CL18_variance_2010,
-CL6_pop2010to2002_rel,
-CL6_max_pop2002,
-CL6_mean_pop2002,
-CL6_median_pop2002,
-CL18_max_pop2002,
-CL18_mean_pop2002,
-CL18_median_pop2002,
-CL6_median_path,
-CL18_median_path) %>% cor() -> corr
corrplot(corr, method = "circle")
df_cleaned %>%
ggplot(aes(x = CL18_centr_clo, y = CL18_density))+
geom_point()
df_cleaned %>%
ggplot(aes(x = CL18_density, y = CL18_centr_clo))+
geom_point()
df_cleaned %>%
ggplot(aes(x = CL18_density, y = CL18_centr_clo))+
geom_point()+
geom_text(aes(x = CL18_density+0.001, y = CL18_centr_clo - 0.01, label = clust_18))
View(clusters_18_metrics)
clusters_18_metrics
clusters_18_metrics %>%
ggplot(aes(x = CL18_density, y = CL18_centr_clo))+
geom_point()+
geom_text(aes(x = CL18_density+0.001, y = CL18_centr_clo - 0.01, label = clust_18))
clusters_18_metrics %>%
ggplot(aes(x = CL18_density, y = CL18_centr_clo))+
geom_point()+
geom_text(aes(x = CL18_density+0.001, y = CL18_centr_clo - 0.001, label = clust_18))
clusters_18_metrics %>%
ggplot(aes(x = CL18_density, y = CL18_centr_clo))+
geom_point()+
geom_text(aes(x = CL18_density+0.0005, y = CL18_centr_clo - 0.001, label = clust_18))
df_cleaned %>%
dplyr::select(-Census2010,
-CL18_dist2Tyumen,
-betw_CL18,
-CL6_n,
-CL6_pop2002,
-CL6_pop2010,
-CL18_pop2002,
-CL18_pop2010,
-CL6_variance_2010,
-CL18_variance_2010,
-CL6_pop2010to2002_rel,
-CL6_max_pop2002,
-CL6_mean_pop2002,
-CL6_median_pop2002,
-CL18_max_pop2002,
-CL18_mean_pop2002,
-CL18_median_pop2002,
-CL6_median_path,
-CL18_median_path) %>% cor() -> corr
corrplot(corr, "number")
clusters_18_metrics %>%
ggplot(aes(x = CL18_density, y = CL18_centr_clo))+
geom_point()+
geom_text(aes(x = CL18_density+0.0005, y = CL18_centr_clo - 0.001, label = clust_18))
clusters_18_metrics %>%
ggplot(aes(x = CL18_density, y = CL18_variance_2002))+
geom_point()+
geom_text(aes(x = CL18_density+0.0005, y = CL18_variance_2002, label = clust_18))
clusters_18_metrics %>%
ggplot(aes(x = CL18_density, y = CL18_centr_clo))+
geom_point()+
geom_text(aes(x = CL18_density+0.0005, y = CL18_centr_clo - 0.001, label = clust_18))
clusters_18_metrics %>%
ggplot(aes(x = CL18_centr_clo, y = CL18_variance_2002))+
geom_point()+
geom_text(aes(x = CL18_centr_clo+0.0005, y = CL18_variance_2002, label = clust_18))
clusters_18_metrics %>%
ggplot(aes(x = CL18_density, y = CL18_centr_clo))+
geom_point()+
geom_text(aes(x = CL18_density+0.0005, y = CL18_centr_clo - 0.001, label = clust_18))
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggforce)
library(corrplot)
library(caret)
library(RColorBrewer)
load(file = "data/Part3_res_dataset.Rdata")
load("data/settlements.Rdata")
df %>%
dplyr:: select(-id, - lon, -lat, -ShortName, -MunicipalDistrict, -Rosstat1990, -clust_3, -clust_6, -clust_18)->
df_cleaned
corr <- cor(df_cleaned)
corrplot(corr, method = "circle")
findCorrelation(corr, cutoff = 0.8, names = T)
clusters_18_metrics %>%
ggplot(aes(x = CL18_density, y = CL18_centr_clo))+
geom_point()+
geom_text(aes(x = CL18_density+0.0005, y = CL18_centr_clo - 0.001, label = clust_18))
df_cleaned %>%
dplyr::select(-Census2010,
-CL18_dist2Tyumen,
-betw_CL18,
-CL6_n,
-CL6_pop2002,
-CL6_pop2010,
-CL18_pop2002,
-CL18_pop2010,
-CL6_variance_2010,
-CL18_variance_2010,
-CL6_pop2010to2002_rel,
-CL6_max_pop2002,
-CL6_mean_pop2002,
-CL6_median_pop2002,
-CL18_max_pop2002,
-CL18_mean_pop2002,
-CL18_median_pop2002,
-CL6_median_path,
-CL18_median_path) %>% cor() -> corr
corrplot(corr, "circle")
df_cleaned %>%
dplyr::select(-Census2010,
-CL18_dist2Tyumen,
-betw_CL18,
-CL6_n,
-CL6_pop2002,
-CL6_pop2010,
-CL18_pop2002,
-CL18_pop2010,
-CL6_variance_2010,
-CL18_variance_2010,
-CL6_pop2010to2002_rel,
-CL6_max_pop2002,
-CL6_mean_pop2002,
-CL6_median_pop2002,
-CL18_max_pop2002,
-CL18_mean_pop2002,
-CL18_median_pop2002,
-CL6_median_path,
-CL18_median_path,
-CL18_density,
-CL18_centr_clo) %>% cor() -> corr
corrplot(corr, "circle")
df_cleaned %>%
dplyr::select(-Census2010,
-betw_CL18,
-CL6_n,
-CL6_pop2002,
-CL6_pop2010,
-CL6_max_pop2002,
-CL6_mean_pop2002,
-CL6_median_pop2002,
-CL6_median_path,
-CL6_variance_2010,
-CL6_pop2010to2002_rel,
-CL6_dist2Tyumen,
-CL18_pop2002,
-CL18_pop2010,
-CL18_variance_2010,
-CL18_dist2Tyumen,
-CL18_max_pop2002,
-CL18_mean_pop2002,
-CL18_median_pop2002,
-CL18_median_path,
-CL18_density,
-CL18_centr_clo) %>% cor() -> corr
corrplot(corr, "circle")
df_cleaned %>%
dplyr::select(-Census2010,
-betw_CL18,
-CL6_n,
-CL6_pop2002,
-CL6_pop2010,
-CL6_max_pop2002,
-CL6_mean_pop2002,
-CL6_median_pop2002,
-CL6_median_path,
-CL6_variance_2010,
-CL6_pop2010to2002_rel,
-CL6_dist2Tyumen,
-CL18_pop2002,
-CL18_pop2010,
-CL18_pop2010to2002_rel,
-CL18_variance_2010,
-CL18_dist2Tyumen,
-CL18_max_pop2002,
-CL18_mean_pop2002,
-CL18_median_pop2002,
-CL18_median_path,
-CL18_density,
-CL18_centr_clo) %>% cor() -> corr
corrplot(corr, "circle")
df_cleaned %>%
dplyr::select(-Census2010,
-betw_CL18,
-CL6_n,
-CL6_pop2002,
-CL6_pop2010,
-CL6_max_pop2002,
-CL6_mean_pop2002,
-CL6_median_pop2002,
-CL6_median_path,
-CL6_variance_2010,
-CL6_pop2010to2002_rel,
-CL6_dist2Tyumen,
-CL18_pop2002,
-CL18_pop2010,
-CL18_pop2010to2002_rel,
-CL18_variance_dif,
-CL18_variance_2010,
-CL18_dist2Tyumen,
-CL18_max_pop2002,
-CL18_mean_pop2002,
-CL18_median_pop2002,
-CL18_median_path,
-CL18_density,
-CL18_centr_clo) %>% cor() -> corr
corrplot(corr, "circle")
df_cleaned %>%
dplyr::select(-Census2010,
-betw_CL18,
-CL6_n,
-CL6_pop2002,
-CL6_pop2010,
-CL6_max_pop2002,
-CL6_mean_pop2002,
-CL6_median_pop2002,
-CL6_median_path,
-CL6_variance_2010,
-CL6_pop2010to2002_rel,
-CL6_dist2Tyumen,
-CL18_pop2002,
-CL18_pop2010,
-CL18_pop2010to2002_rel,
-CL18_variance_dif,
-CL18_variance_2010,
-CL18_dist2Tyumen,
-CL18_max_pop2002,
-CL18_mean_pop2002,
-CL18_median_pop2002,
-CL18_median_path,
-CL18_density,
-CL18_centr_clo) %>% cor() -> corr
corrplot(corr, "number")
